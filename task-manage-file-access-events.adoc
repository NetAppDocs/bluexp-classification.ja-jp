---
sidebar: sidebar 
permalink: task-manage-file-access-events.html 
keywords: compliance, actions, view progress, audit, logs, installation 
summary: スキャンするファイルのいずれかがアクセスまたは変更されたときにイベントがファイルに記録されるように、BlueXPの分類を設定できます。次に、このファイル（ファイルアクセス監査ログ）の内容を表示するか、ファイルをダウンロードして、どのファイル変更が行われたか、誰によって行われたかを確認できます。 
---
= ファイルアクセスイベントを監視および管理します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
スキャンするファイルのいずれかがアクセスまたは変更されたときにイベントがファイルに記録されるように、BlueXPの分類を設定できます。次に、このファイル（ファイルアクセス監査ログ）の内容を表示するか、ファイルをダウンロードして、どのファイル変更が行われたか、誰によって行われたかを確認できます。

たとえば、機密性の高い人事ファイルまたは給与ファイルに変更が加えられたタイミングを追跡する場合は、これらのファイルが存在するボリュームでこの機能を有効にすることができます。次に、ファイルアクセス監査ログを表示して、これらのファイルが変更されているかどうかを確認できます。変更されている場合は、変更を行ったユーザーのセキュリティ識別子(SID)と変更がいつ行われたかを確認できます。

この機能は、ONTAP ソフトウェアを実行している作業環境内の重要なボリュームで有効にすることができます。ボリュームで有効にすると、ボリューム内のすべてのファイルおよびディレクトリについてファイルアクセスイベントが追跡されます。この機能はに基づいています https://docs.netapp.com/us-en/ontap/nas-audit/two-parts-fpolicy-solution-concept.html["FPolicy機能"^] ONTAP システムから、BlueXP分類システムをFPolicyサーバとして使用してONTAP から通知メッセージ（イベント）を受信します。

現在、BlueXPの分類では、ファイルとディレクトリに対する次のアクションのイベントがキャプチャされます。

* 作成
* 読み取り
* 書き込み
* 名前を変更する
* 削除
* 所有者/権限を変更します
* SACL/DACLの変更（アクセス制御リスト（ACL）の変更）


「Account Admin」または「Workspace Admin」ロールを持つBlueXPユーザは、ファイルアクセス監査ログ用にボリュームを設定し、監査ログの表示とダウンロードを行うことができます。「Compliance Viewer」ロールを持つユーザは、監査ログの表示とダウンロードのみを実行できます。



== サポートされているデータソース

BlueXPの分類では、次のデータソースのONTAP ボリュームにあるファイルに対するファイルアクセスイベントがログに記録されます。

* オンプレミスのONTAP
* Cloud Volumes ONTAP
* Azure NetApp Files の特長
* NetApp ONTAP 対応の Amazon FSX


データソースでONTAP バージョン9.11以降のソフトウェアが実行されている必要があります。



== ファイルアクセス監査ログ用にボリュームを設定します

個 々 のボリュームでファイルアクセス監査ログを有効にして、ファイルおよびディレクトリの変更を追跡できます。


TIP: ファイルアクセス監査は、現時点で各データソースの最大5個のボリュームで設定できます。

.作業を開始する前に
* BlueXPの分類でファイルにアクセスしたユーザのIDをリストできるように、データソース用にActive Directoryを設定しておく必要があります。
* BlueXP分類システムからのアウトバウンドアクセス用にポート5018が開いている必要があります。


.手順
. データソースの_Scan Configuration_pageで、をクリックします image:screenshot_horizontal_more_button.gif["[ 詳細 ] アイコン"] を選択し、*[ファイルアクセス監査の設定]*を選択します。
+
image:screenshot_compliance_file_access_audit_button.png["ファイルアクセスログを有効にするボリュームを選択するスクリーンショット。"]

. [ファイルアクセス監査の設定]ダイアログで、*[ファイルアクセスイベントのロギングを有効にする]*のチェックボックスをクリックし、*[保存]*をクリックします。
+
現時点では、すべての潜在的なロギングアクションがデフォルトで選択されていることに注意してください。これらのアクションは編集できません。

+
image:screenshot_compliance_file_access_audit_dialog.png["ボリュームのロギングを有効または無効にしたり、ログに記録する処理を選択したりするためのダイアログのスクリーンショット。"]

. ボリュームのファイルアクセス監査が有効になっていることを確認します。
+
image:screenshot_compliance_file_access_audit_done.png["特定のボリュームでファイルアクセス監査ログが有効になっていることを示すスクリーンショット。"]



.結果
有効なボリューム上のファイルに対して生成されたファイルアクセスイベントはすべてログファイルに追加されます。受信したイベントのタイプをログファイルで確認してください。



== ログファイルの内容

ファイルアクセスイベントを追跡するように設定した各ボリュームについて、ログファイルが作成されます。ログファイルの名前は「<volume_name> _<volume_uuid> _.log」になります（例：「fpolicy_CIFS_838c1727-dd2d-11ed-a3ec-590ce4991.log」）。監査ログの各行には、次の形式で情報が表示されます。

* timestamp -イベントの日時
* クライアントIP -ファイル操作が実行されたインスタンス/PC/プロキシのIPアドレス
* Volume Name -ボリュームの名前
* Volume UUID -ボリュームのUUID
* File Type -ファイルのタイプ（FILEまたはDIR）
* File Size：ファイルのサイズ（バイト単位）
* Path -影響を受けるファイルまたはディレクトリの完全パスと名前
* ボリュームタイプ-ボリュームのタイプ（SMBまたはNFS）
* User ID：アクションを実行したユーザーのSecurity Identifier（SID；セキュリティ識別子）
* File Owner ID：ファイル所有者のセキュリティ識別子（SID）
* イベントタイプ-作成、読み取り、書き込み、名前変更、削除、 所有者/権限の変更、またはSACL/DACLの変更
* アクションの詳細-何が行われたか:アクションによって異なります


たとえば、ログファイルの次の行は、ボリューム「fpolicy_cifs」で「作成」操作が発生したことを示しています。ボリュームに新しいファイル「f14」が作成されたことを示しています。

 {"Timestamp": "2023-04-24 13:57", "Client_IP": "172.31.14.35", "Volume_Name": "fpolicy_cifs", "Volume_UUID": "838c1727-dd2d-11ed-a3ec-590ce4991", "File_Type": "FILE", "File_Size": 100, "Path": \\FPOLICY_CVO\fpolicy_cifs_share\dbs\f14, "Volume_Type": "SMB", "User_ID": "S-1-5-21-459977447-2546672318-3630509715-500", "File_Owner_ID": "S-1-5-32-544", "Event_Type": "CREATE", "Action_Details": {details}}
BlueXPの[Classification Investigation]ページでは、ボリューム（[Storage Repository]フィルタを使用）またはファイル（[File/Directory Path]フィルタを使用）を検索して、該当するボリュームおよびファイルに関する詳細を確認できます。



== ファイルアクセス監査ログファイルにアクセスします

ファイルアクセス監査ログファイルは、BlueXP分類マシンの次の場所にあります。 `/opt/netapp/fpolicy/logs`

各ファイルには、デフォルトで最大50、000件のイベントが格納されるように設定されています。 <<ファイルアクセス監査ログを設定します,この値は、[File Access Audit Log Configuration]ページでカスタマイズできます。>> この最大数に達すると、ログファイル内の古いエントリが上書きされます。

ディレクトリ内のすべてのログファイルの合計サイズは、デフォルトで最大50GBに設定されます。 <<ファイルアクセス監査ログを設定します,この値は、[File Access Audit Log Configuration]ページでカスタマイズできます。>> この制限に達すると、新しいログファイルが追加されるにつれて最も古いログファイルが削除されます。また、14日を経過したログファイルは、最大保持期間であるため上書きされます。

BlueXP分類がオンプレミスのLinuxマシンまたはクラウドに導入したLinuxマシンにインストールされている場合は、ログファイルに直接移動できます。

BlueXP分類をクラウドに導入する場合は、BlueXP分類インスタンスにSSHで接続する必要があります。システムにSSHするには、ユーザとパスワードを入力するか、BlueXPコネクタのインストール時に入力したSSHキーを使用します。SSHコマンドは次のとおりです。

 ssh -i <path_to_the_ssh_key> <machine_user>@<datasense_ip>
* <path-to_The _ssh_key>= SSH認証キーの場所
* <machine_user>：
+
** AWSの場合：<ec2-user>を使用します
** Azureの場合：BlueXPインスタンス用に作成したユーザを使用します
** GCPの場合：BlueXPインスタンス用に作成されたユーザーを使用します


* <datasense_ip> = BlueXP分類仮想マシンインスタンスのIPアドレス


クラウドのシステムにアクセスするには、セキュリティグループのインバウンドルールを変更する必要があります。詳細については、以下を参照してください。

* https://docs.netapp.com/us-en/bluexp-setup-admin/reference-ports-aws.html["AWSのセキュリティグループのルール"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/reference-ports-azure.html["Azureのセキュリティグループルール"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/reference-ports-gcp.html["Google Cloudのファイアウォールルール"^]




== ファイルアクセス監査ログを設定します

ファイルアクセス監査ファイルログには3つのオプションを設定できます。これらの設定は、このBlueXP分類インスタンスでファイルアクセスの監査ログが設定されているすべてのデータソースに適用されます。これらの設定は、BlueXPのclassification_Configuration_pageの_File Access Audit Log_セクションで行います。

image:screenshot_compliance_file_access_audit_config.png["BlueXP分類の[Configuration]ページに表示される監査ログの設定を示すスクリーンショット。"]

[cols="30,50"]
|===
| [監査ログ]オプション | 説明 


| ログファイルの場所 | 現在の場所は、ログファイルを書き込むためにハードコーディングされています `/opt/netapp/fpolicy/logs` 


| 監査ログの最大ストレージ割り当て | ディレクトリ内のすべてのログファイルの合計サイズは、現在デフォルト値の50GBにハードコードされています。この制限に達すると、最も古いログファイルが自動的に削除されます。 


| 監査ファイルあたりの監査イベントの最大数 | 現在、各ファイルには最大50、000個のイベントが格納されるようにハードコーディングされています。この最大数に達すると、新しいイベントが追加されるたびに古いイベントが削除されます。 
|===
これらの設定は現在、デフォルト設定にハードコードされています。変更することはできません。
